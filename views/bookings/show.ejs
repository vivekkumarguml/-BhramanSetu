<% layout('/layouts/boilerplate') %>

<div class="container mt-5 d-flex justify-content-center">
  <div class="card shadow-lg p-4 rounded-4" style="max-width: 600px; width: 100%;">
    
    <!-- Hotel Branding -->
    <div class="text-center border-bottom pb-3 mb-3">
      <h2 class="fw-bold text-primary">üè® BhramanSetu Hotels</h2>
      <p class="mb-0">Luxury ‚Ä¢ Comfort ‚Ä¢ Trust</p>
    </div>

    <!-- Booking Confirmation -->
    <div class="text-center mb-4">
      <i class="fa-solid fa-circle-check text-success fa-3x"></i>
      <h3 class="mt-3 text-success">Booking Confirmed</h3>
      <small class="text-muted">Booking ID: <%= booking._id.toString().slice(-6).toUpperCase() %></small>
    </div>

    <!-- Receipt Section -->
    <div id="booking-receipt">
      <h5 class="mb-3">Guest Details</h5>
      <p><strong>Name:</strong> <%= booking.user.username %></p>
      <p><strong>Email:</strong> <%= booking.user.email %></p>

      <h5 class="mt-4 mb-3">Booking Details</h5>
      <ul class="list-group list-group-flush mb-3">
        <li class="list-group-item">
          <strong>Hotel:</strong> <%= booking.listing.title %>
        </li>
        <li class="list-group-item">
          <strong>Check-in:</strong> <%= booking.fromDate.toDateString() %>
        </li>
        <li class="list-group-item">
          <strong>Check-out:</strong> <%= booking.toDate.toDateString() %>
        </li>
        <li class="list-group-item">
          <strong>Guests:</strong> <%= booking.numberOfPeople %>
        </li>
        <li class="list-group-item">
          <strong>Total Nights:</strong> 
          <%= Math.ceil((booking.toDate - booking.fromDate) / (1000 * 60 * 60 * 24)) %>
        </li>
        <li class="list-group-item">
          <strong>Total Price:</strong> 
          <span class="text-success fw-bold">‚Çπ<%= booking.totalPrice %></span>
        </li>
      </ul>

      <!-- Footer -->
      <div class="mt-4 text-center border-top pt-3">
        <p class="mb-1"><em>Thank you for choosing BhramanSetu Hotels</em></p>
        <small class="text-muted">We look forward to hosting you!</small>
      </div>
    </div>

    <!-- Actions -->
    <div class="text-center mt-4">
      <a href="/listings/<%= booking.listing._id %>" class="btn btn-outline-primary me-2">
        <i class="fa-solid fa-arrow-left"></i> Back to Listing
      </a>
      <button onclick="printReceipt()" class="btn btn-success">
        <i class="fa-solid fa-file-invoice"></i> Print / Download Receipt
      </button>
    </div>
  </div>
</div>

<script>
  function printReceipt() {
    const receipt = document.getElementById("booking-receipt").innerHTML;
    const win = window.open("", "_blank");
    win.document.write(`
      <html>
        <head>
          <title>Booking Receipt</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h2, h3 { color: #2c3e50; text-align: center; }
            .header { border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
            .footer { border-top: 2px solid #333; margin-top: 20px; padding-top: 10px; text-align: center; font-size: 12px; color: #555; }
            ul { list-style: none; padding: 0; }
            li { padding: 8px 0; border-bottom: 1px solid #ddd; }
          </style>
        </head>
        <body>
          <div class="header">
            <h2> BhramanSetu Hotels</h2>
            <p>Luxury ‚Ä¢ Comfort ‚Ä¢ Trust</p>
          </div>
          ${receipt}
          <div class="footer">
            <p><em>Powered by BhramanSetu Booking System</em></p>
          </div>
        </body>
      </html>
    `);
    win.document.close();
    win.print();
  }
</script>
